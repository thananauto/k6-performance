# k6-performance [![Static HTML Report - k6](https://github.com/thananauto/k6-performance/actions/workflows/Result.yml/badge.svg)](https://github.com/thananauto/k6-performance/actions/workflows/Result.yml)

## Types of Testing
1. **Smoke testing** — verify that your system doesn’t throw errors under a minimal load

2. **Load testing** — access the performance of your system during normal and peak loads

3. **Stress testing** — verify the reliability and stability of your system under a heavy load or extreme conditions

4. **Spike testing** — access the performance of your system when there’s a sudden surge of traffic

5. **Soak testing** — verify the reliability and stability of your system over an extended period of time

## Setup
Installation is quite straightforward, although it depends to a degree on the operating system of your machine. Refer [k6](https://k6.io/docs/get-started/installation/) official documentation


## Order of flow
* `init`
* `setup`
* `VU` virtual user
* `tearDown`

```
// 1. initialization code

export function setup() {
  // 2. setup code, you can pass data to VU and teardown
  return {'token': '123456'}
}

export default function (data) {
  // 3. VU code
  console.log(data.token);
}

export function teardown(data) {
  // 4. teardown code
}
```

k6 requires each test script to contain at least one default function, representing the entry point for the VU code. VU will call the VU code over and over again until all conditions are fulfilled.

On the other hand, init code will only run once per VU. Apart from that, the setup and teardown cycles will be called only once per test — at the start and end of the whole test life cycle.

By default k6 will collect following metrics

* `vus` — number of active virtual users
* `vus_max` — maximum virtual users allocated for the test
* `iterations` — aggregated number of times the default function is called
* `iteration_duration` — the total time it took to execute the default function
* `dropped_iterations` — number of iterations that couldn’t be started
* `data_received` — amount of data received
data_sent — amount of data sent
* `checks` — rate of successful checks

In addition, it’ll generate the following output as well if you’re calling HTTP requests:

* `http_reqs` — total requests generated by k6
* `http_req_blocked` — time spent waiting for a free TCP connection before initiating the request
* `http_req_connecting` — time spent establishing a TCP connection
* `http_req_tls_handshaking` — time spent on TLS handshaking
* `http_req_sending` — time spent on data sending
* `http_req_waiting` — time spent waiting for a response from the remote host
* `http_req_receiving` — time spent on data receiving
* `http_req_duration` — total time for the request. It’s calculated based on `http_req_sending + http_req_waiting + http_req_receiving`.

## Available HTTP methods
At the time of this writing, k6 comes with the following HTTP methods.

* `batch` — multiple HTTP requests in parallel
* `del` — DELETE request
* `get` — GET request
* `options` — OPTIONS request
* `patch` — PATCH request
* `post` — POST request
* `put` — PUT request
* `reques` — issue any type of HTTP request

## Checks
k6 provides a way for you to assert the returned response. It’s called check. Please note that check doesn’t halt the execution.

### HTTP response
For your information, each HTTP method will return an HTTP response that contains the following:

* `body`
* `headers`
* `status`
* `timings`
* `timings.blocked`
* `timings.connecting`
* `timings.tls_handshaking`
* `timings.sending`
* `timings.waiting`
* `timings.receiving`
* `timings.duration`

### Checking if status is 200
The most useful fields are body and status. You can simply assign the returned HTTP response to a variable and check if its status is 200 as follows:

```code
import { check } from 'k6';
import http from 'k6/http';
export default function () {
  let res = http.get('http://blazedemo.com/test');
  check(res, {
    'is status 200': (r) => r.status === 200,
  });
}
```
## Overview
Code that supports the perfomance and Load testing of the web application and the generation of HTML report

## Prerequisites

In order to run you have to install `k6` Click [here](https://k6.io/docs/get-started/installation/) to install the latest version

 ## Running
 Test can be running using `k6`

 ```k6 run scripts/demoblaze.js```


 ## Application 
 For demo purpose we performed load on [DemoBlaze](http://blazedemo.com') site

 ## Result
 On successfull execution of scripts, the result can be found in `<root>/result/report.html` 

 For every push the script would execute via githubworkflow and the latest result can be found [here](https://thananauto.github.io/k6-performance). In linux box using `grafana\k6` image to execute the test scripts

 In githubworkflow folder, you can find different ways to setup the tools and infrastructure to execute the scripts

 ## References
* [k6 documentation](https://k6.io/docs/)
* [k6 GitHub](https://github.com/loadimpact/k6)
* [k6 examples](https://k6.io/docs/examples)

